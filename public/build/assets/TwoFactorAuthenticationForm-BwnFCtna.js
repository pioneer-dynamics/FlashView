import{Q as E,d as v,T as H,k as M,D as N,c as y,w as o,o as t,g as u,e as a,a as n,f as r,b as l,u as b,C as Q,F as D,h as Y,n as x,B as S,t as P}from"./app-BRjscsoq.js";import{a as z}from"./DialogModal-B3rgxQWY.js";import{_ as p}from"./ConfirmsPasswordOrPasskey-pgsusYMC.js";import{_ as G}from"./DangerButton-DMXQZWtk.js";import{_ as O,a as U}from"./TextInput-DivJeP8r.js";import{_ as W}from"./InputLabel-BKtx9pUF.js";import{_ as A}from"./PrimaryButton-BJH7Tybb.js";import{_ as C}from"./SecondaryButton-Du11_ILf.js";import"./SectionTitle-Dbw-805w.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ConfirmsPasskey-CSzM0hv7.js";const j={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},I={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},J={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},X={key:3},Z={key:0},ee={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},te={key:0,class:"font-semibold"},oe={key:1},ae=["innerHTML"],se={key:0,class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ne={class:"font-semibold"},re=["innerHTML"],le={key:1,class:"mt-4"},ie={key:1},ue={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 dark:bg-gray-900 dark:text-gray-100 rounded-lg"},ce={class:"mt-5"},de={key:0},me={key:1},Ce={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup($){const B=$,R=E(),c=v(!1),s=v(!1),d=v(!1),_=v(null),h=v(null),g=v([]),m=H({code:""}),f=M(()=>{var i;return!c.value&&((i=R.props.auth.user)==null?void 0:i.two_factor_enabled)});N(f,()=>{f.value||(m.reset(),m.clearErrors())});const V=()=>{c.value=!0,S.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([K(),L(),k()]),onFinish:()=>{c.value=!1,s.value=B.requiresConfirmation}})},K=()=>axios.get(route("two-factor.qr-code")).then(i=>{_.value=i.data.svg}),L=()=>axios.get(route("two-factor.secret-key")).then(i=>{h.value=i.data.secretKey}),k=()=>axios.get(route("two-factor.recovery-codes")).then(i=>{g.value=i.data}),T=()=>{m.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{s.value=!1,_.value=null,h.value=null}})},q=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>k())},F=()=>{d.value=!0,S.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{d.value=!1,s.value=!1}})};return(i,e)=>(t(),y(z,null,{title:o(()=>e[1]||(e[1]=[u(" Two Factor Authentication ")])),description:o(()=>e[2]||(e[2]=[u(" Add additional security to your account using two factor authentication. ")])),content:o(()=>[f.value&&!s.value?(t(),a("h3",j," You have enabled two factor authentication. ")):f.value&&s.value?(t(),a("h3",I," Finish enabling two factor authentication. ")):(t(),a("h3",J," You have not enabled two factor authentication. ")),e[11]||(e[11]=n("div",{class:"mt-3 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[n("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1)),f.value?(t(),a("div",X,[_.value?(t(),a("div",Z,[n("div",ee,[s.value?(t(),a("p",te," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(t(),a("p",oe," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),n("div",{class:"mt-4 p-2 inline-block bg-white",innerHTML:_.value},null,8,ae),h.value?(t(),a("div",se,[n("p",ne,[e[3]||(e[3]=u(" Setup Key: ")),n("span",{innerHTML:h.value},null,8,re)])])):r("",!0),s.value?(t(),a("div",le,[l(W,{for:"code",value:"Code"}),l(O,{id:"code",modelValue:b(m).code,"onUpdate:modelValue":e[0]||(e[0]=w=>b(m).code=w),type:"text",name:"code",class:"block mt-1 w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:Q(T,["enter"])},null,8,["modelValue"]),l(U,{message:b(m).errors.code,class:"mt-2"},null,8,["message"])])):r("",!0)])):r("",!0),g.value.length>0&&!s.value?(t(),a("div",ie,[e[4]||(e[4]=n("div",{class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[n("p",{class:"font-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1)),n("div",ue,[(t(!0),a(D,null,Y(g.value,w=>(t(),a("div",{key:w},P(w),1))),128))])])):r("",!0)])):r("",!0),n("div",ce,[f.value?(t(),a("div",me,[l(p,{onConfirmed:T,seconds:60},{default:o(()=>[s.value?(t(),y(A,{key:0,type:"button",class:x(["me-3",{"opacity-25":c.value}]),disabled:c.value},{default:o(()=>e[6]||(e[6]=[u(" Confirm ")])),_:1},8,["class","disabled"])):r("",!0)]),_:1}),l(p,{onConfirmed:q,seconds:60},{default:o(()=>[g.value.length>0&&!s.value?(t(),y(C,{key:0,class:"me-3"},{default:o(()=>e[7]||(e[7]=[u(" Regenerate Recovery Codes ")])),_:1})):r("",!0)]),_:1}),l(p,{onConfirmed:k,seconds:60},{default:o(()=>[g.value.length===0&&!s.value?(t(),y(C,{key:0,class:"me-3"},{default:o(()=>e[8]||(e[8]=[u(" Show Recovery Codes ")])),_:1})):r("",!0)]),_:1}),l(p,{onConfirmed:F,seconds:60},{default:o(()=>[s.value?(t(),y(C,{key:0,class:x({"opacity-25":d.value}),disabled:d.value},{default:o(()=>e[9]||(e[9]=[u(" Cancel ")])),_:1},8,["class","disabled"])):r("",!0)]),_:1}),l(p,{onConfirmed:F,seconds:60},{default:o(()=>[s.value?r("",!0):(t(),y(G,{key:0,class:x({"opacity-25":d.value}),disabled:d.value},{default:o(()=>e[10]||(e[10]=[u(" Disable ")])),_:1},8,["class","disabled"]))]),_:1})])):(t(),a("div",de,[l(p,{onConfirmed:V,seconds:60},{default:o(()=>[l(A,{type:"button",class:x({"opacity-25":c.value}),disabled:c.value},{default:o(()=>e[5]||(e[5]=[u(" Enable ")])),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Ce as default};
